var browser,chrome,n;const a=!0,c="[FediAct]",t=3,s=/"access_token":".*?",/gm,r={fediact_homeinstance:null,fediact_showfollows:!0};function i(t){a&&console.log(c+" "+t)}async function o(a){return new Promise(async function(e){try{var t=await fetch(a,{method:"HEAD"});t.redirected?e(t.url):e(!1)}catch(t){i(t),e(!1)}})}async function d(){var t="https://"+n.fediact_homeinstance;try{var e=await(await fetch(t)).text()}catch(t){return i(t),!1}if(e){t=e.match(s);if(t){var e=t[0].search(/"access_token":"/),a=t[0].search(/",/);if(-1<e&&-1<a){t=t[0].substring(e+=16,a);if(16<t.length)return n.fediact_token=t,!0}}}n.fediact_token=null,i("Token could not be found.")}async function u(){try{n=await(browser||chrome).storage.local.get(r)}catch(t){return i(t),!1}n.fediact_homeinstance?await d():i("Home instance not set");try{await(browser||chrome).storage.local.set(n)}catch{i(e)}}async function f(){chrome.tabs.query({},async function(t){for(var e=0;e<t.length;++e)try{await chrome.tabs.sendMessage(t[e].id,{updatedfedisettings:!0})}catch(t){continue}})}chrome.runtime.onInstalled.addListener(u),chrome.alarms.create("refresh",{periodInMinutes:t}),chrome.alarms.onAlarm.addListener(u),chrome.runtime.onMessage.addListener((t,n,e)=>{if(t.url)return o(t.url).then(e),!0;t.updatedsettings&&(u(),f()),t.running&&chrome.tabs.onUpdated.addListener(async function(t,e,a){if(t===n.tab.id&&e.url)try{await chrome.tabs.sendMessage(t,{urlchanged:e.url})}catch(t){i(t)}})});