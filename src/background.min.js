var browser,chrome,a,t=!0,n="[FediAct]",o=/"access_token":".*?",/gm,e={fediact_homeinstance:null,fediact_showfollows:!0};function s(e){console.error(n+" Error: "+e)}function i(e){t&&console.log(n+" "+e)}async function r(n){return new Promise(async function(e){var t=await fetch(n,{method:"HEAD"});t.redirected?e(t.url):e(!1)})}async function c(){var e="https://"+a.fediact_homeinstance,e=await(await fetch(e)).text();if(e){e=e.match(o);if(e){var t=e[0].search(/"access_token":"/),n=e[0].search(/",/);if(-1<t&&-1<n){e=e[0].substring(t+=16,n);if(console.log(e),16<e.length)return void(a.fediact_token=e)}}}a.fediact_token=null,i("Token could not be found.")}async function d(){(a=await(browser||chrome).storage.local.get(e)).fediact_homeinstance?await c():i("Home instance not set"),await(browser||chrome).storage.local.set(a)}chrome.runtime.onInstalled.addListener(d),chrome.alarms.create("refresh",{periodInMinutes:1}),chrome.alarms.onAlarm.addListener(d),chrome.runtime.onMessage.addListener((e,a,t)=>{if(e.url)return r(e.url).then(t),!0;e.updatedsettings&&d(),e.running&&chrome.tabs.onUpdated.addListener(function(e,t,n){e===a.tab.id&&t.url&&chrome.tabs.sendMessage(e,{urlchanged:t.url})})});