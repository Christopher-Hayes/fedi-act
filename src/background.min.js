var browser,chrome,a,t=!0,n="[FediAct]",o=/"access_token":".*?",/gm,e={fediact_homeinstance:null,fediact_showfollows:!0};function i(e){console.error(n+" Error: "+e)}function r(e){t&&console.log(n+" "+e)}async function s(n){return new Promise(async function(e){var t=await fetch(n,{method:"HEAD"});t.redirected?e(t.url):e(!1)})}async function c(){var e="https://"+a.fediact_homeinstance,e=await(await fetch(e)).text();if(e){e=e.match(o);if(e){var t=e[0].search(/"access_token":"/),n=e[0].search(/",/);if(-1<t&&-1<n){e=e[0].substring(t+=16,n);if(console.log(e),16<e.length)return void(a.fediact_token=e)}}}a.fediact_token=null,r("Token could not be found.")}async function l(){(a=await(browser||chrome).storage.local.get(e)).fediact_homeinstance?await c():r("Home instance not set"),await(browser||chrome).storage.local.set(a)}chrome.alarms.create("refresh",{periodInMinutes:1}),chrome.runtime.onInstalled.addListener(l),chrome.alarms.onAlarm.addListener(l),chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.url)return s(e.url).then(n),!0;e.updatedsettings&&l()});