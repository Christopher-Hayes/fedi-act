var browser,chrome,t,o=!0,n="[FediFollow]",a=/"access_token":".*?",/gm,e={fedifollow_homeinstance:null,fedifollow_showfollows:!0};function i(e){console.error(n+" Error: "+e)}function l(e){o&&console.log(n+" "+e)}async function r(n){return new Promise(async function(e){var o=await fetch(n,{method:"HEAD"});o.redirected?e(o.url):e(!1)})}async function s(){var e="https://"+t.fedifollow_homeinstance,e=await(await fetch(e)).text();if(e){e=e.match(a);if(e){var o=e[0].search(/"access_token":"/),n=e[0].search(/",/);if(-1<o&&-1<n){e=e[0].substring(o+=16,n);if(console.log(e),16<e.length)return void(t.fedifollow_token=e)}}}t.fedifollow_token=null,l("Token could not be found.")}async function c(){(t=await(browser||chrome).storage.local.get(e)).fedifollow_homeinstance?await s():l("Home instance not set"),await(browser||chrome).storage.local.set(t)}chrome.alarms.create("refresh",{periodInMinutes:1}),chrome.runtime.onInstalled.addListener(c),chrome.alarms.onAlarm.addListener(c),chrome.runtime.onMessage.addListener((e,o,n)=>{if(e.url)return r(e.url).then(n),!0;e.updatedsettings&&c()});